Module 7 - Lab 4 - Configure VPC



bastion host - login to access resources in acc



vpc>
create>
Resources to create>
VPC only>
name>
labvpc
IPv4 CIDR>
10.0.0.0/16
create>

//dns hostname is disabled, to allocate to each instance, we need to enable
actions>
edit vpc settings>
enable dns hostname>
check>



subnets>
create>
VPC ID>
labvpc>
subnet name>
public-subnet
Availability Zone>
us-east-1a>
IPv4 subnet CIDR block>
10.0.0.0/24
create>



select subnet>
actions>
edit subnet settings>
auto-assign IP settings>
Enable auto-assign public IPv4 address>
check>
save>



subnet
create>
subnet name>
private-subnet
Availability Zone>
us-east-1a>
IPv4 subnet CIDR block>
10.0.1.0/24
create>



internet gateway>
create>
name>
my-lab-igw
create>

actions>
attach to vpc>
Available VPCs>
labvpc>
attach>



filet by vpc>
labvpc>



route table>
	//subnet can and must have only 1 route table
	//route table is implicitly attached
edit name>
private-route-table
save>

create>
Name>
private-route-table
vpc>
labvpc>
create>


??public route>
edit routes>
search bar>
0.0.0.0/0>
drop down>
internet gateway>
lab igw>



subnet association>
edit subnet association>
public subnet>
check>
save>


route tables>
routes>
subnet association>
edit subnet association>
private subnet>
check>
save>



nat gateway>
create>
name>
my-nat-gw
	//always launch in public subnet
Subnet>
public subnet>
	\\elastic ip - static (doesnt change)
	\\public ip - new ip once restart
Elastic IP allocation ID>
allocate elastic ip>
create>

	internet gateway
	public subnet resources to reach internet
	enables natting
	also accesses target for route table

	nat gateway
	prevents the internet to reach pvt resources
	private subnet resources to reach internet



route table>
private subnet>
routes>
edit routes>
search bar>
0.0.0.0/0>
drop down>
nat gw>
lab nat gw>
save>





ec2>
launch>
name>
bastion-host
ami>
amazon linux>
key pair>
vocey>
network settings>
vpc>
labvpc>
security grp>
bastion-sg
launch>


launch>
name>
private-instance
no key pair>
network settings>
edit>
vpc>
labvpc>
subnet>
private>
firewall>
selecting existing>
bastion-sg>
advanced details>
user data>

#!/bin/bash
# Turn on password authentication for lab challenge
echo 'lab-password' | passwd ec2-user --stdin
sed -i 's|[#]*PasswordAuthentication no|PasswordAuthentication yes|g' /etc/ssh/sshd_config
systemctl restart sshd.service

launch>







details>
show>
download pem
$ cd Downloads
$ sudo rm -rf labsuser.pem
$ sudo chmod 600 labsuser.pem

bastion host>
copy public ip>

$ sudo ssh -i labsuser.pem ec2-user@54.85.152.58

private-instance>
copy privte ip>

$ ssh ec2-user@10.0.1.134

pw: lab-password


$ ip a
$ yum update
$ sudo yum update
$ ng -c 3 google.com
$ ping -c 3 google.com
$ history

